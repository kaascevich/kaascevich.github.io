---
import ArchivePanel from "$/components/ArchivePanel.astro"
import I18nKey from "$/i18n/i18nKey"
import { i18n } from "$/i18n/translation"
import MainGridLayout from "$/layouts/MainGridLayout.astro"
import { getSortedPosts } from "$/utils/content-utils"
import type { GetStaticPaths } from "astro"

export const getStaticPaths = (async () => {
  const posts = await getSortedPosts()

  const allTags = posts.reduce((acc, post) => {
    post.data.tags.forEach((tag) => acc.add(tag))
    return acc
  }, new Set<string>())

  return Array.from(allTags).map((tag) => ({
    params: { tag },
  }))
}) satisfies GetStaticPaths

const { tag } = Astro.params
---

<MainGridLayout
  title={i18n(I18nKey.archive)}
  description={i18n(I18nKey.archive)}
>
  <ArchivePanel tags={[tag]} />
</MainGridLayout>
