---
import type { Page } from 'astro'
import type { Post } from '$/types/content'

import * as R from 'remeda'
import { getPostUrlByID } from '$/utils/urls'
import PostCard from '$/components/post/card/PostCard.astro'

interface Props {
  page: Page<Post>
}
const { page } = Astro.props

const DELAY_INTERVAL = 50
const entriesWithDelays = R.pipe(
  page.data,
  R.map((entry, index) => [index * DELAY_INTERVAL, entry] as const),
)
---

<ol>
  {
    entriesWithDelays.map(([delay, entry]) => (
      <PostCard
        {entry}
        url={getPostUrlByID(entry.id)}
        class="post-card"
        style={`animation-delay: calc(var(--content-delay) + ${delay}ms);`}
      />
    ))
  }
</ol>

<style lang="scss">
  @use '$/styles/main';
  @use '$/styles/theme' as *;
  @use '$/styles/transition';
  @use '$/styles/utils' as *;
  @use '$/styles/variants';

  ol {
    @include transition;

    display: flex;
    flex-direction: column;
    margin-bottom: spacing(4);
    padding-top: spacing(1);
    padding-bottom: spacing(1);

    border-radius: $radius-xl2;

    background-color: var(--card-bg);

    @include variants.md {
      padding-top: 0;
      padding-bottom: 0;
      gap: spacing(4);

      background-color: transparent;
    }

    :global(.post-card) {
      @extend %onload-animation;
    }
  }
</style>
