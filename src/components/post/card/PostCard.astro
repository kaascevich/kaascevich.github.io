---
import type { Post } from '$/types/content'

import PostMeta from '$/components/post/meta/PostMeta.astro'
import PostLink from '$/components/post/card/PostLink.astro'
import { Icon } from 'astro-icon/components'
import { render } from 'astro:content'
import PostExtraMeta from '$/components/post/meta/PostExtraMeta.astro'

interface Props {
  class?: string
  entry: Post
  url: string
  style: string
}
const { class: className, entry, url, style } = Astro.props

const { title, image, description } = entry.data
const { remarkPluginFrontmatter } = await render(entry)

const coverWidth = image === undefined ? '3.25rem' : '28%'
---

<article class={className} {style}>
  <div class="info-wrapper">
    <h2>
      <a href={url}>
        {title}
        <Icon name="tabler:chevron-right" />
      </a>
    </h2>

    <PostMeta {entry} compactOnMobile={true} class="meta-items" />

    <div class="description">
      {description}
    </div>

    <footer>
      <PostExtraMeta
        wordCount={remarkPluginFrontmatter.words}
        readingTime={remarkPluginFrontmatter.minutes}
      />
    </footer>
  </div>

  <PostLink {entry} {url} />
</article>

<style lang="scss" define:vars={{ 'cover-width': coverWidth }}>
  @use '$/styles/main';
  @use '$/styles/theme' as *;
  @use '$/styles/utils' as *;
  @use '$/styles/variants';

  article {
    @extend %card-base;

    display: flex;
    position: relative;
    flex-direction: column-reverse;
    width: 100%;
    overflow: hidden;

    border-radius: $radius-xl2;

    @include variants.md {
      flex-direction: column;
    }

    // post separator
    &:not(:first-child)::after {
      @include transition;

      content: '';

      margin-right: spacing(6);

      margin-left: spacing(6);

      border-top-width: 1px;
      border-style: dashed;
      border-color: black(10%);

      @include variants.dark {
        border-color: white(15%);
      }

      @include variants.md {
        display: none;
      }
    }

    .info-wrapper {
      padding: spacing(6);

      @include variants.md {
        width: calc(100% - var(--cover-width) - 12px);
        padding-top: spacing(7);
        padding-right: spacing(2);
        padding-left: spacing(9);
      }

      h2 a {
        @include transition;
        @include font-size($text-xl3);
        @include text-plain(90%);

        display: block;
        width: 100%;
        margin-bottom: spacing(3);

        font-weight: $font-weight-bold;

        &:hover {
          color: var(--primary);
        }

        &:active {
          color: var(--title-active);
        }

        @include variants.dark {
          &:hover {
            color: var(--primary);
          }

          &:active {
            color: var(--title-active);
          }
        }

        &::before {
          content: '';

          display: none;
          position: absolute;
          top: spacing(9);
          left: spacing(4.5);
          width: spacing(1);
          height: spacing(5);

          border-radius: $radius-md;

          background-color: var(--primary);

          @include variants.md {
            display: block;
          }
        }

        svg {
          display: inline;
          position: absolute;
          width: spacing(8);
          height: spacing(8);
          translate: 0;

          color: var(--primary);

          @include variants.md {
            @include transition;

            translate: spacing(-1);

            opacity: 0%;
          }
        }

        @include variants.md {
          &:hover svg {
            translate: 0;

            opacity: 100%;
          }
        }
      }

      :global(.meta-items) {
        margin-bottom: spacing(4);
      }

      .description {
        @include transition;
        @include text-plain(75%);

        margin-bottom: spacing(3.5);
        padding-right: spacing(4);
      }
    }

    footer {
      @include transition;
    }
  }
</style>
