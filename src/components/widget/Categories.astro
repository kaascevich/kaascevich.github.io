---
import WidgetLayout from "$/components/widget/WidgetLayout.astro"

import { i18n } from "$/i18n/translation"
import I18nKey from "$/i18n/i18nKey"
import { getCategoryList } from "$/utils/content-utils"
import { getCategoryUrl } from "$/utils/url-utils"
import ButtonLink from "$/components/control/ButtonLink.astro"

const categories = await getCategoryList()

const COLLAPSED_HEIGHT = "7.5rem"
const COLLAPSE_THRESHOLD = 5

const isCollapsed = categories.size >= COLLAPSE_THRESHOLD

type Props = Readonly<{
  class?: string | undefined
  style?: string | undefined
}>

const { class: className, style } = Astro.props
---

<WidgetLayout
  name={i18n(I18nKey.categories)}
  id="categories"
  {isCollapsed}
  collapsedHeight={COLLAPSED_HEIGHT}
  class={className}
  {style}
>
  {
    [...categories].map(([name, count]) => (
      <ButtonLink
        url={getCategoryUrl(name)}
        badge={String(count)}
        label={`View all posts in the ${name} category`}
      >
        {name}
      </ButtonLink>
    ))
  }
</WidgetLayout>
