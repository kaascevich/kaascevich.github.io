---
import WidgetLayout from '$/components/widget/WidgetLayout.astro'
import ButtonLink from '$/components/control/ButtonLink.astro'
import { getCategoryCounts } from '$/utils/content'
import strings from '$/config/strings'

const categories = await getCategoryCounts()

const COLLAPSED_HEIGHT = '7.5rem'
const COLLAPSE_THRESHOLD = 5

const isCollapsed = categories.size >= COLLAPSE_THRESHOLD

interface Props {
  class?: string
  style?: string
}

const { class: className, style } = Astro.props
---

<WidgetLayout
  name={strings.categories.label}
  id="categories"
  {isCollapsed}
  collapsedHeight={COLLAPSED_HEIGHT}
  class={className}
  {style}
>
  {
    Array.from(categories, ([name, count]) => (
      <ButtonLink
        url={`/archive/category/${name}/`}
        badge={String(count)}
        label={strings.alts.category(name)}
      >
        {name}
      </ButtonLink>
    ))
  }
</WidgetLayout>
