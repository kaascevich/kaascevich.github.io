---
import WidgetLayout from "$/components/widget/WidgetLayout.astro"
import ButtonTag from "$/components/control/ButtonTag.astro"
import { getTagCounts } from "$/utils/content"
import strings from "$/config/strings"
import { url } from "$/utils/urls"

const tags = await getTagCounts()

const COLLAPSED_HEIGHT = "7.5rem"
const COLLAPSE_THRESHOLD = 20

const isCollapsed = tags.size >= COLLAPSE_THRESHOLD

type Props = Readonly<{
  class?: string | undefined
  style?: string | undefined
}>

const { class: className, style } = Astro.props
---

<WidgetLayout
  name={strings.tags.label}
  id="tags"
  {isCollapsed}
  collapsedHeight={COLLAPSED_HEIGHT}
  class={className}
  {style}
>
  <ul class="flex gap-2 flex-wrap">
    {
      [...tags].map(([name]) => (
        <ButtonTag
          href={url(`/archive/tag/${name}/`)}
          label={strings.alts.tag(name)}
        >
          {name}
        </ButtonTag>
      ))
    }
  </ul>
</WidgetLayout>
