---
import { getSortedPosts, groupPostsByYear } from '$/utils/content'
import ArchiveGroup from '$/components/archive/ArchiveGroup.astro'

type Filter =
  | { type: 'tag'; tag: string }
  | { type: 'category'; category: string }

interface Props {
  filter?: Filter
}
const { filter } = Astro.props

const posts = (await getSortedPosts()).filter((post) => {
  if (filter === undefined) {
    return true
  }

  switch (filter.type) {
    case 'tag':
      return post.data.tags.includes(filter.tag)
    case 'category':
      return post.data.category === filter.category
  }
})

const groups = await groupPostsByYear(posts)
---

<ol>
  {groups.map((group) => <ArchiveGroup {group} />)}
</ol>

<style lang="scss">
  @use '$/styles/main';
  @use '$/styles/theme' as *;
  @use '$/styles/utils' as *;
  @use '$/styles/variants';

  ol {
    @extend %card-base;
    padding: spacing(6) spacing(8);
  }
</style>
